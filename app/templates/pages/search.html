{% extends "base.html" %}

{% block page_title %}
{% if search_query %}{{ search_query }}{% else %}Search{% endif %} | Hey Gurgle: Marsupial Gurgle Audio Archive Search
{% endblock page_title %}

{% block content %}
{% include "core/nav.html" %}

<main id="results" class="mt-3 mb-1">
    <span class="d-none" id="content-top"></span>
    <div class="container-fluid p-4 pt-3">
{% if search_query and search_results %}
    {% for clip in search_results %}
        <article class="audio-clip pb-2">
            <h2 class="pb-2">{{ clip.title }}</h2>
            <audio controls class="w-100 px-1" preload="none"
                src="{{ mg_audio_url_prefix }}/{{ clip.mp3_path }}"></audio>
            
            <div class="download-info px-1 py-2 mb-2">
                <a class="btn btn-info m-1 ms-0" data-bs-toggle="collapse" href="#clip-{{ clip.id }}-info" title="Clip Information" role="button"
                    aria-expanded="false" aria-controls="clip-{{ clip.id }}-info">
                    <i class="bi bi-info-circle pe-1"></i>
                    Clip Info
                </a>
                {% if clip.mp3_path is not none %}
                <a class="btn btn-primary m-1 ms-0" role="button" href="{{ mg_audio_url_prefix }}/{{ clip.mp3_path }}">
                    <i class="bi bi-download pe-1"></i><span class="d-none">Download</span>
                    MP3
                </a>
                {% else %}
                <a class="btn btn-dark m-1 ms-0 disabled" aria-disabled="true">
                    <i class="bi bi-dash-circle-dotted pe-1"></i><span class="d-none">Download not available</span>
                    MP3
                </a>
                {% endif %}
                {% if clip.m4a_path is not none %}
                <a class="btn btn-primary m-1 ms-0" role="button" href="{{ mg_audio_url_prefix }}/{{ clip.m4a_path }}">
                    <i class="bi bi-download pe-1"></i><span class="d-none">Download</span>
                    MPEG-4
                </a>
                {% else %}
                <a class="btn btn-dark m-1 ms-0 disabled" aria-disabled="true">
                    <i class="bi bi-dash-circle-dotted pe-1"></i><span class="d-none">Download not available</span>
                    MPEG-4
                </a>
                {% endif %}
                {% if clip.m4r_path is not none %}
                <a class="btn btn-primary m-1 ms-0" role="button" href="{{ mg_audio_url_prefix }}/{{ clip.m4r_path }}">
                    <i class="bi bi-download pe-1"></i><span class="d-none">Download</span>
                    MPEG-4 Ringtone
                </a>
                {% else %}
                <a class="btn btn-dark m-1 ms-0 disabled" aria-disabled="true">
                    <i class="bi bi-dash-circle-dotted pe-1"></i><span class="d-none">Download not available</span>
                    MPEG-4 Ringtone
                </a>
                {% endif %}
                <div class="collapse pt-3 pb-2" id="clip-{{ clip.id }}-info">
                    <div class="card-group">
                        <div class="card card-body">
                            <b>Artist:</b>
                            {% if clip.artist %}
                            {{ clip.artist }}
                            {% else %}
                            N/A
                            {% endif %}
                        </div>
                        <div class="card card-body">
                            <b>Album:</b>
                            {% if clip.album %}
                            {{ clip.album }}
                            {% else %}
                            N/A
                            {% endif %}
                        </div>
                        <div class="card card-body">
                            <b>Year:</b>
                            {% if clip.year %}
                            {{ clip.year }}
                            {% else %}
                            N/A
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </article>
    {% endfor %}

    {% include "core/pagination.html" %}
{% elif error == "ProgrammingError" %}
        <div class="mt-3 mb-5">
            <div class="alert alert-warning mx-3" role="alert">
                <i class="bi bi-exclamation-triangle pe-1"></i><span class="d-none">Warning</span>
                There was an issue with handling the search query <q>{{ search_query }}</q>. Please
                modify your search query and try again.
            </div>
        </div>
{% elif error == "DatabaseError" %}
        <div class="mt-3 mb-5">
            <div class="alert alert-warning mx-3" role="alert">
                <i class="bi bi-exclamation-triangle pe-1"></i><span class="d-none">Warning</span>
                Your search could not be performed due to a database server error. Please try your
                search again at a later time.
            </div>
        </div>
{% elif search_query and not search_results %}
        <div class="mt-3 mb-5">
            <div class="alert alert-info mx-3" role="alert">
                <i class="bi bi-info-circle pe-1"></i><span class="d-none">Information</span>
                No search results found for <q>{{ search_query }}</q>.
                {% if search_mode == 2 %}
                Try the <a href="{{ url_for('main.search', query=search_query, mode=1) }}">search again</a>
                with natural language search mode.
                {% endif %}
            </div>
        </div>
{% elif not search_query %}
        <div class="mt-3 mb-5">
            <div class="alert alert-warning mx-3" role="alert">
                <i class="bi bi-info-circle pe-1"></i><span class="d-none">Information</span>
                No search query was provided.
            </div>
        </div>
{% endif %}
    </div>
</main>
{% endblock content %}
